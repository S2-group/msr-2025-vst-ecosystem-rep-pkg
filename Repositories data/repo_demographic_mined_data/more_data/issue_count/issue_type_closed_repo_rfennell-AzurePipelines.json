{"total_count": 659, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/rfennell/AzurePipelines/issues/1544", "repository_url": "https://api.github.com/repos/rfennell/AzurePipelines", "labels_url": "https://api.github.com/repos/rfennell/AzurePipelines/issues/1544/labels{/name}", "comments_url": "https://api.github.com/repos/rfennell/AzurePipelines/issues/1544/comments", "events_url": "https://api.github.com/repos/rfennell/AzurePipelines/issues/1544/events", "html_url": "https://github.com/rfennell/AzurePipelines/issues/1544", "id": 1822121066, "node_id": "I_kwDOAoLSoM5sm1xq", "number": 1544, "title": "Wrap More in Retry Logic", "user": {"login": "nnnvvvcv", "id": 3199833, "node_id": "MDQ6VXNlcjMxOTk4MzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3199833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnnvvvcv", "html_url": "https://github.com/nnnvvvcv", "followers_url": "https://api.github.com/users/nnnvvvcv/followers", "following_url": "https://api.github.com/users/nnnvvvcv/following{/other_user}", "gists_url": "https://api.github.com/users/nnnvvvcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnnvvvcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnnvvvcv/subscriptions", "organizations_url": "https://api.github.com/users/nnnvvvcv/orgs", "repos_url": "https://api.github.com/users/nnnvvvcv/repos", "events_url": "https://api.github.com/users/nnnvvvcv/events{/privacy}", "received_events_url": "https://api.github.com/users/nnnvvvcv/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 257878262, "node_id": "MDU6TGFiZWwyNTc4NzgyNjI=", "url": "https://api.github.com/repos/rfennell/AzurePipelines/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 257878264, "node_id": "MDU6TGFiZWwyNTc4NzgyNjQ=", "url": "https://api.github.com/repos/rfennell/AzurePipelines/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 1252982793, "node_id": "MDU6TGFiZWwxMjUyOTgyNzkz", "url": "https://api.github.com/repos/rfennell/AzurePipelines/labels/WIKIUpdater", "name": "WIKIUpdater", "color": "d93f0b", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-26T10:42:58Z", "updated_at": "2023-07-31T13:43:49Z", "closed_at": "2023-07-29T14:35:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Azure DevOps Extensions\r\n\r\nWIKI Updater\r\n\r\n### Platform\r\n\r\nAzure DevOps Services\r\n\r\n### Azure DevOps Server (TFS) Version\r\n\r\n_No response_\r\n\r\n### Extension Version\r\n\r\n_No response_\r\n\r\n### Describe the bug\r\n\r\nWe have quite a concurrent pipeline with a single build/test followed by a large set of deployment stages running in parallel. Part of the deployment stages we use the Release Notes Generator task followed by the WikiUpdater task.\r\n\r\nBecause these deployments are happening in parallel occasionally we hit the scenario where two WikiUpdater tasks are running around the same time on the same wiki repo.\r\n\r\nOne of the tasks succeeds but the other fails with:\r\n\r\n```\r\nCloned dev.azure.com/<org>/<project>/_git/release_notes to /home/vsts/work/1/s\\repo\r\nSet GIT values in /home/vsts/work/1/s\\repo\r\nPull in case of post clone updates from other users\r\nWorking file name is __latest.md\r\nCreated the '__latest.md' in '/home/vsts/work/1/s\\repo/SIT/SFI' - fixing line-endings\r\nAdded SIT/SFI/__latest.md to repo /home/vsts/work/1/s\\repo\r\nCommitted file \"/home/vsts/work/1/s\\repo\" with message \"SFI SIT Release notes from build [60243]\" as SHA 81f8e9f\r\nAttempt 1 - Push to dev.azure.com/<org>/<project>/_git/release_notes\r\nPush failed, probably due to target being updated completed, will retry up to 32 times\r\nPull to get updates from other users\r\n##[error]Error: Need to specify how to reconcile divergent branches.\r\n##[error]Error: Need to specify how to reconcile divergent branches.\r\n```\r\n\r\nLooking at the code - the retry is around only the git push command - but because the remote repo has been updated by a parallel task it is the pull which is failing. I think this could be fixed by using a `rebase` rather than `pull` when iterating through the retries.\r\n\r\nThe line in question is: \r\n\r\nhttps://github.com/rfennell/AzurePipelines/blob/70073f554776d99a3f24921a7c3fe6724253172e/Extensions/WikiUpdater/WikiUpdaterTask/src/GitWikiFuntions.ts#L320\r\n\r\n\r\n### Repo Steps\r\n\r\nRun tasks in parallel against the same wiki repo\r\n\r\n### Expected Behavior\r\n\r\nAll parallel tasks complete (albeit with possibly retries)\r\n\r\n### Logging Information\r\n\r\nCloned dev.azure.com/<org>/<project>/_git/release_notes to /home/vsts/work/1/s\\repo\r\nSet GIT values in /home/vsts/work/1/s\\repo\r\nPull in case of post clone updates from other users\r\nWorking file name is __latest.md\r\nCreated the '__latest.md' in '/home/vsts/work/1/s\\repo/SIT/SFI' - fixing line-endings\r\nAdded SIT/SFI/__latest.md to repo /home/vsts/work/1/s\\repo\r\nCommitted file \"/home/vsts/work/1/s\\repo\" with message \"SFI SIT Release notes from build [60243]\" as SHA 81f8e9f\r\nAttempt 1 - Push to dev.azure.com/<org>/<project>/_git/release_notes\r\nPush failed, probably due to target being updated completed, will retry up to 32 times\r\nPull to get updates from other users\r\n##[error]Error: Need to specify how to reconcile divergent branches.\r\n##[error]Error: Need to specify how to reconcile divergent branches.", "reactions": {"url": "https://api.github.com/repos/rfennell/AzurePipelines/issues/1544/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rfennell/AzurePipelines/issues/1544/timeline", "performed_via_github_app": null, "state_reason": "completed", "score": 1.0}]}